---
// src/pages/[...locale]/sound.astro
import "@/styles/global.css";
import { Image } from "astro:assets";
import BaseLayout from "@/layouts/BaseLayout.astro";
import PageLayout from "@/layouts/PageLayout.astro";
import { defaultLang, locales } from "@/../i18n.config";
import { getI18nInfo } from "@/utils/i18n";
import { getShortSoundCloudTracksLinks } from "@/utils/getSoundCloudTracksLinks";
import { soundSocialNetworksList } from "@/constants/socialNetworksList";
import { djBio } from "@/constants/photos";
import Separador from "@/components/Separador.astro";
import { djEmail } from "@/constants/email";

// Genera rutas estÃ¡ticas: "/", "/en"
export function getStaticPaths() {
  return locales.map((lang) => {
    if (lang === defaultLang) {
      return { params: { locale: undefined } };
    }
    return { params: { locale: lang } };
  });
}

const { dictionary, langParam } = await getI18nInfo(Astro.params.locale);
const { soundPage, common } = dictionary;

const tracksLinks = await getShortSoundCloudTracksLinks();
---

<BaseLayout
  title={soundPage.title}
  lang={langParam}
  description={soundPage.description}
>
  <PageLayout
    title={soundPage.title}
    phrase={soundPage.heading}
    socialNetworksList={soundSocialNetworksList}
  >
    <div class="animate-on-scroll mb-4 flex w-full items-center gap-4">
      <div class="relative h-150 w-full md:h-150">
        <Image
          src={djBio}
          alt={soundPage.bio.altImage}
          class="absolute h-full w-full rounded-lg object-cover object-top shadow-lg"
          loading="eager"
        />
      </div>
    </div>

    <section class="animate-on-scroll w-full">
      <div class="mb-4 flex w-full items-center gap-4">
        <Separador />
        <h3 class="shrink-0 text-2xl font-bold md:text-3xl">
          {soundPage.media.title}
        </h3>
        <Separador />
      </div>
      <div class="mt-5 grid w-full grid-cols-1 gap-8 md:grid-cols-2">
        <!-- TODO -->
        ğŸ—ï¸ Coming soon...
      </div>
    </section>

    <section class="animate-on-scroll w-full">
      <div class="mb-4 flex w-full items-center gap-4">
        <Separador />
        <h3 class="shrink-0 text-2xl font-bold md:text-3xl">
          {soundPage.design.title}
        </h3>
        <Separador />
      </div>
      <div
        class="mt-5 flex w-full flex-row flex-wrap items-start justify-center gap-x-35 gap-y-8"
      >
        <!-- TODO -->
        ğŸ—ï¸ Coming soon...
      </div>
    </section>

    <section class="animate-on-scroll w-full">
      <div class="mb-4 flex w-full items-center gap-4">
        <Separador />
        <h3 class="shrink-0 text-2xl font-bold md:text-3xl">
          {soundPage.tools.title}
        </h3>
        <Separador />
      </div>
      <div
        class="mt-5 flex w-full flex-row flex-wrap items-start justify-center gap-x-35 gap-y-8"
      >
        <!-- TODO -->
        ğŸ—ï¸ Coming soon...
      </div>
    </section>

    <section class="animate-on-scroll w-full">
      <div class="mb-4 flex w-full items-center gap-4">
        <Separador />
        <h3 class="shrink-0 text-2xl font-bold md:text-3xl">
          {soundPage.bio.title}
        </h3>
        <Separador />
      </div>
      <div class="flex w-full flex-col items-center gap-8">
        <p class="w-full text-justify text-base md:text-lg">
          {soundPage.bio.text}
        </p>
      </div>
      <div class="mt-10 flex w-full items-center justify-center gap-8">
        <p class="text-center text-base md:text-lg">
          {common.contactMe}
        </p>
        <div
          id="copy-email"
          class="cursor-pointer font-bold transition-transform duration-300 ease-in-out hover:scale-110"
          title={common.copyToClipboard ?? "Copiar al portapapeles"}
        >
          {djEmail}
        </div>
      </div>
    </section>
  </PageLayout>
</BaseLayout>

<script>
  import { initScrollAnimations } from "@/utils/animations";
  // Ejecutamos la funciÃ³n en el evento 'astro:page-load'
  // Este evento se dispara en la carga inicial Y en cada navegaciÃ³n por View Transitions
  document.addEventListener("astro:page-load", () => {
    initScrollAnimations();

    const emailSpan = document.getElementById("copy-email");
    if (!emailSpan) return;

    const originalText = emailSpan.textContent;
    // Asumimos que el diccionario i18n tendrÃ¡ una clave para el texto "Copiado"
    // Si no, usamos un valor por defecto.
    const copiedMessage =
      emailSpan.dataset.copiedText ??
      (document.documentElement.lang === "es" ? "Â¡Copiado!" : "Copied!");

    const handleClick = () => {
      if (!originalText) return;

      navigator.clipboard.writeText(originalText).then(() => {
        emailSpan.textContent = copiedMessage;
        setTimeout(() => {
          emailSpan.textContent = originalText;
        }, 1000);
      });
    };

    emailSpan.addEventListener("click", handleClick);
  });
</script>
